module TestFFT
using Test
using Muscade

a     = 1/2
c     = âˆš(âˆš2 /a) # Plancherel norm of g is 1
g(t)  = c  *exp(-Ï€*(t/a)^2)   
Gf(f) = c*a*exp(-Ï€*(f*a)^2)     # ğ”‰f(g)(f)

## Testing ğ”‰, ğ”‰â»Â¹

p1       = 6
n1       = 2^p1
Î´t1      = .04
Î´f1      = 1/(n1*Î´t1)
t1       = Î´t1*(-n1/2:n1/2-1)
f1       = Î´f1*(0:n1/2-1)
x1       = Complex.(g.(t1))
X1       = Complex.(Gf.(f1))
Î´f1â€²     = Muscade.getÎ´f(n1,Î´t1   )
Î´t1â€²     = Muscade.getÎ´t(n1,Î´f1â€²)
X1â€²â€²     = Muscade.ğ”‰(g.(t1),Î´t1) 
x1â€²â€²     = Muscade.ğ”‰â»Â¹(X1â€²â€²,Î´f1)

p2      = 6
n2      = 2^p2
Î´t2     = .02
Î´f2     = 1/(n2*Î´t2)
t2      = Î´t2*(-n2/2:n2/2-1)
f2      = Î´f2*(0:n2/2-1)
x2      = Complex.(g.(t2))
X2      = Complex.(Gf.(f2))
Î´f2â€²    = Muscade.getÎ´f(n2,Î´t2    )
Î´t2â€²    = Muscade.getÎ´t(n2,Î´f2â€²)
X2â€²â€²    = Muscade.ğ”‰(g.(t2),Î´t2) 
x2â€²â€²    = Muscade.ğ”‰â»Â¹(X2â€²â€²,Î´f2)

p3      = 7
n3      = 2^p3
Î´t3     = .04
Î´f3     = 1/(n3*Î´t3)
t3      = Î´t3*(-n3/2:n3/2-1)
f3      = Î´f3*(0:n3/2-1)
x3      = Complex.(g.(t3))
X3      = Complex.(Gf.(f3))
Î´f3â€²    = Muscade.getÎ´f(n3,Î´t3    )
Î´t3â€²    = Muscade.getÎ´t(n3,Î´f3â€²)
X3â€²â€²    = Muscade.ğ”‰(g.(t3),Î´t3) 
x3â€²â€²    = Muscade.ğ”‰â»Â¹(X3â€²â€²,Î´f3)

@testset "ğ”‰" begin
   @test X1â€²â€²[1:4:end] â‰ˆ [1.189207114814641 + 6.215787535650553e-11im, 0.17478665016678313 - 3.1401849173675505e-18im, 0.0005549583962780497 - 4.906538933386798e-20im, 3.7946754330555795e-8 - 1.2131379938500347e-17im, -9.433487289666338e-11 + 0.0im, -7.883303225766639e-11 - 3.7252857920461104e-17im, -6.910835631031991e-11 - 9.813077866773595e-20im, -6.382811459257399e-11 - 1.2560739669470202e-17im]
   @test X2â€²â€²[1:4:end] â‰ˆ [1.1876054622925485 + 4.422702434962231e-5im, -0.00018588382990463145 + 9.199760500100245e-21im, -0.00027110446788896394 + 0.0im, -0.00013749500103721685 + 7.666467083416872e-21im, -8.684352943376467e-5 + 0.0im, -6.345077476921056e-5 + 3.3732455167034237e-20im, -5.165241997780222e-5 + 2.453269466693399e-20im, -4.594358275790417e-5 + 2.453269466693399e-20im]
   @test X3â€²â€²[1:8:end] â‰ˆ [1.1892071150027212 + 0.0im, 0.17478665034221738 - 2.5121479338940404e-17im, 0.0005549585430093939 - 4.293221566713448e-20im, 3.806399293350315e-8 - 1.2923827836724815e-17im, 5.647308555393803e-14 + 0.0im, -8.814090226233139e-18 - 3.6308807366980927e-19im, 3.056773755499975e-17 + 0.0im, -3.7682219008410604e-17 - 2.5121479338940404e-17im]
end
@testset "ğ”‰â»Â¹" begin
   @test x1â€²â€²[1:8:end]  â‰ˆ [1.9239580570698244e-9, 1.5708528559273443e-5, 0.009780887836558198, 0.46443393200699334, 1.6817928305074294, 0.4644339320069935, 0.009780887836558198, 1.5708528559457435e-5]
   @test x2â€²â€²[1:8:end]  â‰ˆ [0.009780887836558566, 0.09297437103021428, 0.46443393200699346, 1.2191590255005362, 1.6817928305074292, 1.2191590255005367, 0.46443393200699346, 0.09297437103021478]
   @test x3â€²â€²[1:16:end] â‰ˆ [0.0, -4.4082185729647003e-17, 1.923958302396771e-9, 0.009780887836558276, 1.6817928305074294, 0.009780887836558425, 1.9239581797332973e-9, -1.724955093768796e-17]
end

@testset "Î´t vs. Î´f" begin
   @test Î´t1â€² â‰ˆ Î´t1
   @test Î´f1â€² â‰ˆ Î´f1
   @test Î´t2â€² â‰ˆ Î´t2
   @test Î´f2â€² â‰ˆ Î´f2
   @test Î´t3â€² â‰ˆ Î´t3
   @test Î´f3â€² â‰ˆ Î´f3
end

@testset "ğ”‰ is unitary" begin
   @test (sum(abs2.(X1â€²â€²))-abs2(X1â€²â€²[1])/2).*Î´f1   â‰ˆ 1.
   @test (sum(abs2.(X2â€²â€²))-abs2(X2â€²â€²[1])/2).*Î´f2   â‰ˆ 0.999994103038435
   @test (sum(abs2.(X3â€²â€²))-abs2(X3â€²â€²[1])/2).*Î´f3   â‰ˆ 1.
end

end #module
